/*! verify - v1.3 - 2013-11-11 2:45:07 PM
* Copyright (c) 2013 迟伤; Licensed  */
KISSY.add("gallery/verify/1.3/index",function(a,b,c){function d(a,b){d.superclass.constructor.call(this,b),this.init(a)}b.all;var e={required:function(a,b,c){return""===a?[!1,c?c:"\u4eb2\uff0c\u6b64\u9879\u76ee\u4e3a\u5fc5\u586b\u9879\u3002"]:[!0]},name:function(a,b,c){return""===a?[!0]:/^[\/\u4E00-\u9FA5A-Za-z]+$/.test(a)?[!0]:[!1,c?c:"\u59d3\u540d\u53ea\u80fd\u7531\u4e2d\u6587\u6216\u82f1\u6587\u5b57\u6bcd\u7ec4\u6210\uff0c\u8bf7\u68c0\u67e5\u662f\u5426\u5b58\u5728\u5176\u5b83\u5b57\u7b26\u3002"]},length:function(a,b,c){return""===a?[!0]:0===a.length?[!0]:b[0]&&a.length<b[0]?[!1,c?c:"\u4eb2\uff0c\u957f\u5ea6\u81f3\u5c11\u9700\u8981"+b[0]+"\u3002"]:b[1]&&a.length>b[1]?[!1,c?c:"\u4eb2\uff0c\u957f\u5ea6\u6700\u591a\u4e0d\u80fd\u8d85\u8fc7"+b[1]+"\u3002"]:[!0]},email:function(a,b,c){return""===a?[!0]:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(a)?[!0]:[!1,c?c:"\u4eb2\uff0c\u8bf7\u8f93\u5165\u6b63\u786e\u7684email\u683c\u5f0f\u3002"]},english:function(a,b,c){return""===a?[!0]:/^[A-Za-z]+$/.test(a)?[!0]:[!1,c?c:"\u4eb2\uff0c\u8fd9\u91cc\u53ea\u80fd\u8f93\u5165\u82f1\u6587\u5b57\u6bcd\u3002"]},mobile:function(a,b,c){return""===a?[!0]:/^[0-9\-]*$/.test(a)?[!0]:[!1,c?c:"\u624b\u673a\u53f7\u7801\u5fc5\u987b\u4e3a\u6570\u5b57\u3002"]},range:function(b,c,d){if(""===b)return[!0];var e=c[0],f=c[1],g=d?d:"\u4eb2\uff0c\u53ea\u80fd\u5728{min}\u81f3{max}\u4e4b\u95f4\u3002";return e&&e>b||f&&b>f?[!1,a.substitute(g,{min:e,max:f})]:[!0]},number:function(a,b,c){return""===a?[!0]:/^\d+$/.test(a)?[!0]:[!1,c?c:"\u4eb2\uff0c\u53ea\u80fd\u8f93\u5165\u6570\u5b57\u3002"]},date:function(a,b,c){return""===a?[!0]:/^(\d{4})(-|\/)(\d{2})\2(\d{2})$/.test(a)?[!0]:[!1,c?c:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u65e5\u671f\u683c\u5f0f\uff1aYYYY-MM-DD\u3002"]},pattern:function(a,b,c){return""===a?[!0]:new RegExp(b[0]).test(a)?[!0]:[!1,c?c:"\u4eb2\uff0c\u8f93\u5165\u683c\u5f0f\u6709\u8bef\u3002"]}};return a.extend(d,c,{init:function(b){var c=this;c.container=a.one(b),c.publish("verify"),c.publish("fail");var d=c.get("fields");a.each(d,function(a,b){c.add(b,a)}),c._bindEvent()},_bindUI:function(a){var b=this,c=b.get("autoVerify"),d=b.get("nodeFn");if(c){var e=d.call(b,a);if(!e)return;e.on("change",function(){b.verify(a)}),e.on("blur",function(){""==e.val()&&b.verify(a)})}},_detachUI:function(a){var b=this,c=b.get("nodeFn"),d=c.call(b,a);d&&(d.detach("change"),d.detach("blur"))},_bindEvent:function(){var a=this;a.on("verify",function(b){var c=b.field,d=b.succeed,e=b.info;a._afterVerify(c,d,e)}),a.on("fail",function(b){var c=b.field,d=b.info;a.error(c,d)})},_afterVerify:function(a,b,c){var d=this;b?d.reset(a):d.fire("fail",{field:a,info:c})},_getFunctionName:function(a){return"string"==typeof a.name?a.name:/function\s+([^\{\(\s]+)/.test(a.toString())?RegExp.$1:"[Unknown]"},verify:function(b){var c=this,d=c.get("fields"),e=null,f={succeed:!0,results:[],firstError:null},g={};if("undefined"==typeof b)g=d;else if(a.isString(b)){var h=d[b];if(!h)return f;g[b]=h}else a.isArray(b)&&a.each(b,function(a){g[a]=d[a]});return a.each(g,function(a,b){var d=c._verify(b,a);d.succeed||(f.succeed=!1),d.succeed||e||(e=d),f.results.push(d)}),e&&(f.firstError=e),f},_verify:function(b,c){function d(b,c){var d={};return a.each(b,function(a,b){d[a]=c[b]}),d}var f=this,g=f.get("valueFn"),h=f.get("disabled"),i=g.call(this,b),j={field:b,succeed:!0,results:[]},k=[],l=j.results,m=null,n="",o=null;if(h[b])return j;for(var p=0,q=c.length;q>p;p++){var m=c[p];if(a.isArray(m)?(n=m[0],o=m[m.length-1],o==n&&(o=""),k=e[n](i,m.slice(1,m.length),o)):a.isFunction(m)?(n=f._getFunctionName(m),k=m(i)):(n=m,k=e[m]&&e[m](i)||[!0]),k=d(["rule","value","succeed","info"],[n,i].concat(k)),l.push(k),j.info=k.info,j.succeed=k.succeed,!k.succeed)break}return f.fire("verify",j),j},add:function(a,b){var c=this,d=c.get("fields");d[a]||(d[a]=b),d[a]._bindedUI||(d[a]._bindedUI=!0,c._bindUI(a))},remove:function(a){var b=this,c=b.get("fields");c[a]&&(b._detachUI(a),b.reset(a),c[a]._bindedUI=!1,delete c[a])},modify:function(a,b){var c=this;c.remove(a),c.add(a,b)},disable:function(a,b){var c=this,d=c.get("disabled");d[a]=b},error:function(b,c){function d(){g.hasClass("verifyError")&&e._hideOtherTips(i)}var e=this,f=e.get("nodeFn"),g=f.call(e,b),h=e.get("state"),i=h[b],j=e.container;i||(i=h[b]={name:b,node:g}),i.info=c;var k;i.errorWraper||(e.get("errorWraper")?k=j.one(e.get("errorWraper")):(k=g.parent(".verify-wrap"),k||(a.DOM.wrap(g,a.DOM.create('<span class="verify-wrap"/>')),k=g.parent(".verify-wrap"))),i.errorWraper=k),g.addClass("verifyError").removeClass("verifyNormal"),e._showTip(i),"text"===g.prop("type")&&(i.event||(i.event=g.on("focus",d)))},reset:function(b){var c=this,d=c.get("fields");return"undefined"==typeof b?a.each(d,function(a,b){c._reset(b)}):c._reset(b),this},_reset:function(a){var b=this,c=b.get("nodeFn"),d=b.get("state"),e=c.call(b,a);if(e){var f=d[a];e.removeClass("verifyError").addClass("verifyNormal"),f&&(b._hideTips(f),b._hideIcon(f),f=null)}},_hideTips:function(b){var c=this,d=c.get("state");"undefined"==typeof b?a.each(d,function(a){c._hideTip(a)}):c._hideTip(b)},_hideTip:function(a){var b=this;b._showIcon(a),a.errorTip&&a.errorTip.addClass("hidden")},_showTip:function(b){var c=this,d=c.container;if(!b.errorTip){var e=c.get("errorTipTpl"),f=a.DOM.create(e);b.errorWraper.append(f),b.errorTip=d.one(f),b.infoWraper=b.errorTip.one(".J_InfoContainer")||b.errorTip;var g=b.node,h=g.outerWidth();b.errorTip.css({left:h})}b.infoWraper.html(b.info),b.errorTip.removeClass("hidden"),c._hideIcon(b)},_hideIcon:function(a){var b=this,c=b.get("errorClass");a&&a.errorWraper&&a.errorWraper.removeClass(c)},_showIcon:function(a){var b=this,c=b.get("errorClass");a&&a.errorWraper&&a.errorWraper.one(".verifyError")&&a.errorWraper.addClass(c)},_hideOtherTips:function(b){var c=this,d=c.get("state");a.later(function(){a.each(d,function(a){a.name===b.name?c._showTip(a):c._hideTips(a)})},50,!1,this)},_destroy:function(){var a=this;a.set("state",null),a.set("fields",null)}},{ATTRS:{fields:{value:{}},container:{value:null},nodeFn:{value:function(a){return this.container.one("#"+a)}},valueFn:{value:function(a){var b=this.get("nodeFn"),c=b.call(this,a),d=c&&c.val();return d?d:""}},disabled:{value:{}},state:{value:{}},errorClass:{value:"verify-wrap-error"},autoVerify:{value:!0},errorTipTpl:{value:'<div class="verify-errortip hidden verify-errortip-left"><em class=" tooltip-arrow tooltip-arrow-left tooltip-arrow-horizontal-left" style="top: 6.8px;"></em><span class="tooltip-close"></span><span class="tooltip-confirm"></span><div class="content-box J_InfoContainer"></div></div>'},errorWraper:{value:null}}}),d},{requires:["node","base","./index.css"]});